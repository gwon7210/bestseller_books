<div style="font-size:12px; color:gray;">최근 업데이트: 2025-10-05 19:27:43</div>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>출판사 베스트셀러 대시보드</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #222;
    }
    .dashboard-wrapper {
      max-width: 1400px;
      margin: 0 auto;
    }
    .category-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .category-button {
      padding: 10px 20px;
      background-color: #3498db;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .category-button:hover {
      background-color: #2980b9;
    }
    .category-button.active {
      background-color: #2c3e50;
    }
    .dashboard {
      overflow-x: scroll;
      overflow-y: hidden;
      white-space: nowrap;
      padding-bottom: 10px;
      scrollbar-gutter: stable;
      scrollbar-color: #9aa7c5 #edf1f7;
      scrollbar-width: thin;
    }
    .dashboard::-webkit-scrollbar {
      height: 12px;
    }
    .dashboard::-webkit-scrollbar-track {
      background: #edf1f7;
    }
    .dashboard::-webkit-scrollbar-thumb {
      background-color: #9aa7c5;
      border-radius: 6px;
      border: 2px solid #edf1f7;
    }
    .dashboard::-webkit-scrollbar-thumb:hover {
      background-color: #6c7aa3;
    }
    .publisher {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: inline-block;
      vertical-align: top;
      margin-right: 20px;
      margin-bottom: 15px;
      white-space: normal;
      min-width: 320px;
    }
    .publisher h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #333;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    .category-label {
      font-size: 0.8em;
      color: #666;
      margin-left: 5px;
    }
    .book {
      display: flex;
      margin-bottom: 10px;
      gap: 10px;
    }
    .book img {
      width: 50px;
      height: 70px;
      object-fit: cover;
      border-radius: 4px;
    }
    .book-details {
      font-size: 13px;
    }
    .book-title {
      font-weight: bold;
      margin-bottom: 3px;
      color: #333;
    }
    .book-title a {
      color: #333;
      text-decoration: none;
    }
    .book-title a:hover {
      color: #0066cc;
      text-decoration: underline;
    }
    .book-meta {
      font-size: 0.9em;
      color: #666;
      margin-top: 8px;
    }
    .category-columns {
      display: flex;
      flex-direction: row;
      gap: 20px;
      flex-wrap: nowrap;
      align-items: flex-start;
      margin-top: 5px;
    }
    .category-column {
      flex: 1 1 220px;
      min-width: 200px;
      background-color: #f5f7fb;
      border: 1px solid #eef1f6;
      border-radius: 8px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .category-column-title {
      font-weight: bold;
      font-size: 14px;
      color: #2c3e50;
      margin-bottom: 4px;
    }
    .release-date {
      color: #e67e22;
      font-weight: bold;
    }
    .new-badge {
      background-color: #e74c3c;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.8em;
      margin-left: 8px;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>출판사 주간 베스트셀러 대시보드</h1>
  <div class="dashboard-wrapper">
    <div class="category-buttons" id="category-buttons"></div>
    <div class="dashboard" id="dashboard">
      <div class="loading">카테고리를 선택해주세요.</div>
    </div>
  </div>

  <script>
    const categories = ['경제경영', '에세이', '건강취미', '컬러링북', '공예(뜨개)', '웹툰단행본'];
    const categoryMap = {
      '경제경영': 'economics_data',
      '에세이': 'essay_data',
      '건강취미': 'hobbyHealth_data',
      '컬러링북': 'coloringBooks_data',
      '공예(뜨개)': 'handicraft_data',
      '웹툰단행본': 'webtoons_data'
    };

    function renderButtons(defaultCategory) {
      const container = document.getElementById('category-buttons');
      container.innerHTML = '';
      categories.forEach(category => {
        const btn = document.createElement('button');
        btn.className = 'category-button';
        btn.textContent = category;
        if (category === defaultCategory) btn.classList.add('active');
        btn.onclick = () => {
          document.querySelectorAll('.category-button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          loadData(category);
        };
        container.appendChild(btn);
      });
    }

    async function loadData(category) {
      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = '<div class="loading">데이터를 불러오는 중...</div>';
      const dir = categoryMap[category];
      try {
        const publishers = ['aladin', 'kyobo', 'yes24', 'ypbooks'];
        const data = {};

        for (const pub of publishers) {
          const targets = [{ path: `${dir}/${pub}_${dir.split('_')[0]}.json`, variant: 'default' }];

          if (category === '건강취미') {
            if (pub === 'aladin') {
              targets.push({ path: 'cooking&home_data/aladin_cooking&home.json', variant: 'cooking' });
            } else if (pub === 'kyobo') {
              targets.push({ path: 'HomeLife_data/kyobo_HomeLife.json', variant: 'homelife' });
              targets.push({ path: 'hobbies&sports_data/kyobo_hobbies&sports.json', variant: 'sports' });
              targets.push({ path: 'cooking_data/kyobo_cooking.json', variant: 'cooking' });
            } else if (pub === 'yes24') {
              targets.push({ path: 'home&housekeeping_data/yes24_home&housekeeping.json', variant: 'home' });
            } else if (pub === 'ypbooks') {
              targets.push({ path: 'health_data/ypbooks_health.json', variant: 'health' });
              targets.push({ path: 'hobbies&leisure_data/ypbooks_hobbies&leisure.json', variant: 'hobbies' });
            }
          }

          for (const target of targets) {
            try {
              const response = await fetch(target.path);
              if (response.ok) {
                const books = await response.json();
                if (!Array.isArray(books) || books.length === 0) continue;
                if (!data[pub]) data[pub] = [];
                data[pub].push({ books, variant: target.variant });
              }
            } catch (err) {
              console.log(`${pub}의 ${category} 데이터를 불러올 수 없습니다. (${target.variant})`);
            }
          }
        }

        const available = Object.fromEntries(
          Object.entries(data).filter(([, entries]) => Array.isArray(entries) && entries.length > 0)
        );

        if (Object.keys(available).length === 0) {
          dashboard.innerHTML = '<div class="loading">해당 카테고리의 데이터가 없습니다.</div>';
        } else {
          renderDashboard(available, category);
        }
      } catch (err) {
        dashboard.innerHTML = '<div class="loading">데이터 로딩 오류가 발생했습니다.</div>';
      }
    }

    function getPublisherName(pub) {
      if (pub === 'aladin') return '알라딘';
      if (pub === 'kyobo') return '교보문고';
      if (pub === 'yes24') return '예스24';
      if (pub === 'ypbooks') return '영풍문고';
      return pub;
    }

    function getCategoryLabel(pub, category, variant) {
      if (category === '건강취미') {
        if (pub === 'aladin') return variant === 'cooking' ? '요리/살림' : '건강/취미';
        if (pub === 'kyobo') {
          if (variant === 'homelife') return '가정생활';
          if (variant === 'sports') return '취미/스포츠';
          if (variant === 'cooking') return '요리';
          return '건강';
        }
        if (pub === 'yes24') return variant === 'home' ? '가정 살림' : '건강 취미';
        if (pub === 'ypbooks') {
          if (variant === 'health') return '건강';
          if (variant === 'hobbies') return '취미/레저';
          return '가정/생활/요리';
        }
      } else if (category === '에세이') {
        return pub === 'ypbooks' ? '비소설' : '에세이';
      } else if (category === '컬러링북') {
        if (pub === 'aladin') return '예술/대중문화 > 컬러링북';
        if (pub === 'kyobo') return '예술/대중문화 > 디자인/색채 > 컬러링북';
        if (pub === 'yes24') return '예술 > 미술 > 컬러링';
        return '컬러링북';
      } else if (category === '공예(뜨개)') {
        if (pub === 'aladin') return '건강/취미 > 공예';
        if (pub === 'kyobo') return '취미/실용/스포츠 > 생활공예/DIY';
        if (pub === 'yes24') return '건강취미 > 공예';
        return '공예';
      } else if (category === '웹툰단행본') {
        if (pub === 'aladin') return '만화 > 인터넷연재만화';
        if (pub === 'kyobo') return '만화 > 웹툰/카툰에세이';
        if (pub === 'yes24') return '만화/라이트노벨 > 웹툰';
        return '웹툰';
      }
      return category;
    }

    function renderDashboard(data, category) {
      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = '';

      for (const pub in data) {
        const entries = data[pub];
        if (!Array.isArray(entries) || entries.length === 0) continue;

        const pubDiv = document.createElement('div');
        pubDiv.className = 'publisher';

        const title = document.createElement('h3');
        const name = getPublisherName(pub);
        title.innerHTML = `${name}<span class="category-label">(${category})</span>`;
        pubDiv.appendChild(title);

        const columnsContainer = document.createElement('div');
        columnsContainer.className = 'category-columns';

        entries.forEach(entry => {
          const books = entry.books;
          if (!Array.isArray(books) || books.length === 0) return;

          const column = document.createElement('div');
          column.className = 'category-column';

          const columnTitle = document.createElement('div');
          columnTitle.className = 'category-column-title';
          columnTitle.textContent = getCategoryLabel(pub, category, entry.variant);
          column.appendChild(columnTitle);

          books.forEach(book => {
            const bookDiv = document.createElement('div');
            bookDiv.className = 'book';

            const img = document.createElement('img');
            img.src = book.image || book.img || book.image_url || '';
            img.alt = book.title || '표지';

            const details = document.createElement('div');
            details.className = 'book-details';

            const bookTitle = document.createElement('div');
            bookTitle.className = 'book-title';

            if (book.detail_url || book.book_link) {
              const a = document.createElement('a');
              a.href = book.detail_url || book.book_link;
              a.target = '_blank';
              a.textContent = book.title;
              bookTitle.appendChild(a);
            } else {
              bookTitle.textContent = book.title;
            }

            const dateStr = book.release_date || '';
            const match = dateStr.match(/(\d{4})년\s*(\d{1,2})월/);
            if (match) {
              const release = new Date(match[1], match[2] - 1, 1);
              const now = new Date();
              const diff = (now - release) / (1000 * 60 * 60 * 24);
              if (diff <= 5) {
                const badge = document.createElement('span');
                badge.className = 'new-badge';
                badge.textContent = 'NEW';
                bookTitle.appendChild(badge);
              }
            }

            const meta = document.createElement('div');
            meta.className = 'book-meta';
            const releaseInfo = dateStr ? `<span class="release-date">${dateStr}</span> | ` : '';
            const author = book.author || '저자 미상';
            const price = book.price || book.sales_point || book.sales_index || '가격 정보 없음';

            meta.innerHTML = `${releaseInfo}${author} | ${price}`;

            details.appendChild(bookTitle);
            details.appendChild(meta);
            bookDiv.appendChild(img);
            bookDiv.appendChild(details);
            column.appendChild(bookDiv);
          });

          if (column.children.length > 1) {
            columnsContainer.appendChild(column);
          }
        });

        if (columnsContainer.children.length > 0) {
          pubDiv.appendChild(columnsContainer);
          dashboard.appendChild(pubDiv);
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const defaultCategory = '경제경영';
      renderButtons(defaultCategory);
      loadData(defaultCategory);
    });
  </script>
</body>
</html>
